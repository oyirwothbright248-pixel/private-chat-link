<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Private Chat</title>
    <script src="/socket.io/socket.io.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0f172a;
            --panel: #1e293b;
            --accent: #38bdf8;
            --text: #f8fafc;
            --bubble-me: #0284c7;
            --bubble-them: #334155;
        }

        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--bg); 
            color: var(--text);
            margin: 0; 
            display: flex; 
            flex-direction: column; 
            height: 100vh;
        }

        /* Header */
        header {
            padding: 20px;
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #334155;
            text-align: center;
        }

        /* Chat Area */
        #chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .msg {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 15px;
            line-height: 1.4;
            animation: fadeIn 0.2s ease;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .me { align-self: flex-end; background: var(--bubble-me); color: white; border-bottom-right-radius: 4px; }
        .them { align-self: flex-start; background: var(--bubble-them); border-bottom-left-radius: 4px; }

        /* Input Area */
        .input-area {
            padding: 20px;
            background: var(--panel);
            display: flex;
            gap: 10px;
            border-top: 1px solid #334155;
        }

        input {
            flex: 1;
            background: #0f172a;
            border: 1px solid #334155;
            padding: 12px 16px;
            border-radius: 25px;
            color: white;
            outline: none;
        }

        input:focus { border-color: var(--accent); }

        button {
            background: var(--accent);
            color: #0f172a;
            border: none;
            padding: 0 20px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.1s;
        }

        button:active { transform: scale(0.95); }
    </style>
</head>
<body>

<header>
    <div style="font-weight: 600; letter-spacing: -0.5px;">SECURE ROOM</div>
    <div id="room-id" style="font-size: 10px; color: var(--accent); opacity: 0.8;"></div>
</header>

<div id="chat-container"></div>

<div class="input-area">
    <input type="text" id="msgInput" placeholder="Message..." autocomplete="off">
    <button onclick="send()">Send</button>
</div>

<script>
    const socket = io();
    const roomId = window.location.pathname.split('/').pop();
    const chatContainer = document.getElementById('chat-container');
    const msgInput = document.getElementById('msgInput');

    document.getElementById('room-id').textContent = `ID: ${roomId}`;
    socket.emit('join-room', roomId);

    function send() {
        if (!msgInput.value.trim()) return;
        const data = { roomId, msg: msgInput.value, sender: socket.id };
        socket.emit('chat-msg', data);
        renderMessage(data.msg, 'me');
        msgInput.value = '';
    }

    // Support Enter Key
    msgInput.addEventListener("keypress", (e) => { if (e.key === "Enter") send(); });

    socket.on('render-msg', (data) => {
        if (data.sender !== socket.id) {
            renderMessage(data.msg, 'them');
        }
    });

    function renderMessage(text, type) {
        const div = document.createElement('div');
        div.className = `msg ${type}`;
        div.textContent = text;
        chatContainer.appendChild(div);
        chatContainer.scrollTop = chatContainer.scrollHeight;
    }
</script>
</body>
</html>